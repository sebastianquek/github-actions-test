name: Test cache global node modules

on:
  workflow_dispatch:


jobs:
  test_cache:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Get latest firebase-tools version
        id: latest-firebase-version
        run: |
          npm view firebase-tools version
          LATEST_VERSION=$(npm view firebase-tools version)
          echo "version=$LATEST_VERSION" >> $GITHUB_OUTPUT
      
      - name: Configure npm global path
        run: |
          mkdir -p ~/.npm-global
          npm config set prefix '~/.npm-global'
          echo "::add-path::${HOME}/.npm-global/bin"

      - name: Cache global node modules
        id: cache-global-node-modules
        uses: actions/cache@v4
        env:
          cache-name: cache-global-node-modules
        with:
          path: ~/.npm-global
          key: ${{ runner.os }}-global-node-firebase-${{ steps.latest-firebase-version.outputs.version }}

      # - name: Install firebase-tools globally
      #   run: npm install -g firebase-tools

      - name: Install firebase-tools globally
        if: steps.cache-global-node-modules.outputs.cache-hit != 'true'
        run: npm install -g firebase-tools

      - name: Call firebase
        run: |
          which firebase
          firebase --version
      
      